<!DOCTYPE html>
<html lang="en">
	<head>
		<title>BikeVR</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
		
		<!-- Reload every 3 seconds for simplicity -->
		<!-- <meta http-equiv="refresh" content="10" > -->

		<link rel="stylesheet" href="css/style.css">
	</head>
	<body>
		<div id="loading">Loading...</div>
		<div id="progress"></div>

		<div id="vr">
			<div id="controls" class="padding-bottom">
				<button id="back">New Route</button>
				<button id="playToggle">></button>
				<button id="mapToggle">-</button>
			</div>
			<div id="map"></div>
		</div>

		<!-- Shaders! -->
		<script type="x-shader/x-vertex" id="vertexShader">
			uniform sampler2D displace;
			
			varying vec2 vUv;

			void main() {
				// Clear out ripples
				float nearCenter = max(sign(((position.x * position.x) + (position.z * position.z)) - 5000.0), 0.0);
				float bottomHalf = max(sign(position.y), 0.0);
				float changeY = sign(nearCenter + bottomHalf);
				float updatedX = (1.0 - changeY) * position.x * 5.2 + changeY * position.x;
				float updatedY = (1.0 - changeY) * -360.0 + changeY * position.y;
				float updatedZ = (1.0 - changeY) * position.z * 5.2 + changeY * position.z;

				vUv = uv;
				vec4 vPosition = modelViewMatrix * vec4(updatedX, updatedY, updatedZ, 1.0);
				vec3 vNormal = normalize(normalMatrix * normal) * changeY;
				vec3 displacementVector = texture2D(displace, vUv).xyz;
				float df = 20.0 * displacementVector.x;
				vec4 displacedPosition = vec4(vNormal.xyz * df, 0.0) + (vPosition / 250.0);
				gl_Position = projectionMatrix * displacedPosition;
			}
		</script>
		<script type="x-shader/x-fragment" id="fragmentShader">
			uniform sampler2D texture;
			uniform float nextBlend;
			
			varying vec2 vUv;

			void main() {
				vec4 color = vec4(texture2D(texture, vUv).rgb, nextBlend);
				gl_FragColor = color;
			}
		</script>

		<!-- Maybe add in the api key here? -->
		<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB6UARVCUzMTt42FlGx-HRWlPPr2NJhzVM" type="text/javascript"></script>

		<script src="js/lib/v3_epoly.js" type="text/javascript"></script>
		<script src="js/lib/hidden.js" type="text/javascript"></script>
		
		<script src="js/lib/jquery.min.js" type="text/javascript"></script>
		<script src="js/lib/jquery.base64.min.js" type="text/javascript"></script>
		<script src="js/lib/pako_inflate.min.js" type="text/javascript"></script>
		<script src="js/lib/GSVPano.js" type="text/javascript"></script>
		<script src="js/lib/GSVPanoDepth.js" type="text/javascript"></script>

		<script src="js/lib/three.min.js" type="text/javascript"></script>
		<script src="js/lib/stats.min.js" type="text/javascript"></script>
		<script src="js/lib/threex.rendererstats.js" type="text/javascript"></script>
		<script src="js/lib/FirstPersonControls.js" type="text/javascript"></script>
		<script src="js/lib/WebVR.js" type="text/javascript"></script>

		<script src="js/route.js" type="text/javascript"></script>
		<script src="js/keys.js" type="text/javascript"></script>
		<script src="js/util.js" type="text/javascript"></script>
		<script src="js/index.js" type="text/javascript"></script>
	</body>
</html>