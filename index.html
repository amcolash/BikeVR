<!DOCTYPE html>
<html lang="en">
	<head>
		<title>BikeVR</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
		
		<!-- Reload every 3 seconds for simplicity -->
		<!-- <meta http-equiv="refresh" content="10" > -->

		<link rel="stylesheet" href="css/style.css">
	</head>
	<body>
		<div id="loading">Loading...</div>
		<div id="progress"></div>

		<div id="vr">
			<div id="controls" class="padding-bottom">
				<button id="playToggle">></button>
				<button id="mapToggle">-</button>
			</div>
			<div id="map"></div>
		</div>

		<!-- Shaders! -->
		<script type="x-shader/x-vertex" id="vertexShader">
			uniform sampler2D displace;
			uniform sampler2D prevDisplace;
			uniform sampler2D nextDisplace;
			uniform float prevBlend;
			uniform float nextBlend;
			
			varying vec2 vUv;

			void main() {
				vUv = uv;
				vec2 inverseUV = vec2(max(uv.x - 0.5, 0.5 - uv.x), uv.y);
				vec4 vPosition = modelViewMatrix * vec4(position.xyz, 1.0);
				vec3 vNormal = normalize(normalMatrix * normal);
				vec3 displacementVector = mix(texture2D(displace, vUv).xyz, texture2D(nextDisplace, inverseUV).xyz, nextBlend);
				float df = 20.0 * displacementVector.x;
				//df = 15.0;
				vec4 displacedPosition = vec4(vNormal.xyz * df, 0.0) + (vPosition / 250.0);
				gl_Position = projectionMatrix * displacedPosition;
			}
		</script>
		<script type="x-shader/x-fragment" id="fragmentShader">
			uniform sampler2D texture;
			uniform sampler2D prevTexture;
			uniform sampler2D nextTexture;
			uniform sampler2D displace;
			uniform sampler2D prevDisplace;
			uniform sampler2D nextDisplace;
			uniform float prevBlend;
			uniform float nextBlend;
			
			varying vec2 vUv;

			void main() {
				//vec4 color = mix(texture2D(texture, vUv), texture2D(nextTexture, vUv), 0.0);
				vec2 inverseUV = vec2(1.0 - vUv.x, vUv.y);
				vec2 inverseUV2 = vec2(-vUv.x, vUv.y);
				inverseUV = vUv;
				vec4 color = vec4(mix(texture2D(texture, vUv).xyz, texture2D(prevTexture, inverseUV).xyz, prevBlend), 1.0);
				color.xyz = mix(color.xyz, texture2D(nextTexture, inverseUV2).xyz, nextBlend);

				color.xyz = mix(texture2D(texture, vUv).xyz, texture2D(nextTexture, vUv).xyz, nextBlend);
				gl_FragColor = color;
			}
		</script>

		<!-- Maybe add in the api key here? -->
		<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB6UARVCUzMTt42FlGx-HRWlPPr2NJhzVM" type="text/javascript"></script>
		<script src="js/lib/v3_epoly.js" type="text/javascript"></script>

		<script src="js/lib/hidden.js" type="text/javascript"></script>
		
		<script src="js/lib/jquery.min.js" type="text/javascript"></script>
		<script src="js/lib/jquery.base64.min.js" type="text/javascript"></script>
		<script src="js/lib/zpipe.min.js" type="text/javascript"></script>
		<script src="js/lib/GSVPano.js" type="text/javascript"></script>
		<script src="js/lib/GSVPanoDepth.js" type="text/javascript"></script>

		<script src="js/lib/three.min.js" type="text/javascript"></script>
		<script src="js/lib/stats.min.js" type="text/javascript"></script>
		<script src="js/lib/threex.rendererstats.js" type="text/javascript"></script>
		<script src="js/lib/FirstPersonControls.js" type="text/javascript"></script>
		<script src="js/lib/WebVR.js" type="text/javascript"></script>

		<script src="js/route.js" type="text/javascript"></script>
		<script src="js/keys.js" type="text/javascript"></script>
		<script src="js/util.js" type="text/javascript"></script>
		<script src="js/index.js" type="text/javascript"></script>
	</body>
</html>